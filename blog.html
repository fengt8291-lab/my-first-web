<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <title>æˆ‘çš„åšå®¢æ—¥å¿—</title>
        <style>
        /* --- 1. å…¨å±€å˜é‡å®šä¹‰ (é…è‰²ç³»ç»Ÿ) --- */
        :root {
            --primary-color: #6366f1; /* ç°ä»£ç´« */
            --primary-hover: #4f46e5;
            
            /* äº®è‰²æ¨¡å¼ */
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --input-bg: #f1f5f9;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* æš—è‰²æ¨¡å¼ (è‡ªåŠ¨è¦†ç›–) */
        [data-theme="dark"] {
            --primary-color: #818cf8;
            --primary-hover: #6366f1;
            
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --input-bg: #334155;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        /* --- 2. åŸºç¡€é‡ç½® --- */
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding-top: 80px; /* ç»™å›ºå®šå¤´éƒ¨ç•™ç©ºé—´ */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        a { text-decoration: none; color: inherit; transition: color 0.2s; }
        a:hover { color: var(--primary-color); }
        button { font-family: inherit; }

        /* --- 3. é¡¶éƒ¨å¯¼èˆª (ç£¨ç ‚ç»ç’ƒæ•ˆæœ) --- */
        header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: rgba(255, 255, 255, 0.8); /* äº®è‰²æ¨¡å¼åŠé€æ˜ */
            backdrop-filter: blur(10px); /* ç£¨ç ‚æ•ˆæœ */
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 5%;
            z-index: 100;
            transition: background 0.3s;
        }

        [data-theme="dark"] header {
            background: rgba(30, 41, 59, 0.8); /* æš—è‰²æ¨¡å¼åŠé€æ˜ */
        }

        .logo { font-size: 1.25rem; font-weight: 800; color: var(--text-color); }
        .nav-links { display: flex; align-items: center; gap: 20px; }
        .nav-links a { font-weight: 500; color: var(--text-secondary); }
        .nav-links a:hover { color: var(--primary-color); }

        /* å¯¼èˆªæ æŒ‰é’® */
        .nav-btn {
            padding: 6px 16px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .nav-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }

        /* --- 4. å¸ƒå±€å®¹å™¨ --- */
        .container { max-width: 700px; margin: 0 auto; padding: 0 20px; }

        /* --- 5. ç¼–è¾‘å™¨å¡ç‰‡ --- */
        .editor-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .editor-card:focus-within {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .editor-title { margin: 0 0 1rem 0; font-size: 1.1rem; font-weight: 700; color: var(--text-color); }

        /* æ–‡æœ¬åŸŸ */
        #postInput {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid var(--input-bg);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
        }
        #postInput:focus { border-color: var(--primary-color); background-color: var(--card-bg); }

        .clearfix {
            display: flex;
            justify-content: flex-end;
            width: 100%;
            margin-top: 12px;
        }

        /* å‘å¸ƒæŒ‰é’® */
        .publish-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.3);
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .publish-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 8px -1px rgba(99, 102, 241, 0.4); }
        .publish-btn:active { transform: translateY(0); }

        /* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .image-uploader { margin-bottom: 1rem; display: flex; align-items: center; gap: 10px; }
        .upload-btn {
            background-color: var(--input-bg);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            border: 1px dashed var(--border-color);
            transition: all 0.2s;
        }
        .upload-btn:hover { color: var(--primary-color); border-color: var(--primary-color); }
        
        .upload-hint { font-size: 0.8rem; color: var(--text-secondary); opacity: 0.7; }
        
        #previewContainer { margin-top: 10px; position: relative; display: none; }
        #imagePreview { max-height: 250px; border-radius: 8px; display: block; box-shadow: var(--shadow-sm); }
        #removeImageBtn {
            position: absolute; top: 5px; right: 5px;
            background: rgba(0,0,0,0.6); color: white;
            border: none; padding: 4px 8px; border-radius: 4px;
            cursor: pointer; font-size: 0.75rem;
        }
        #removeImageBtn:hover { background: rgba(0,0,0,0.8); }

        /* --- 6. å¸–å­åˆ—è¡¨ --- */
        .post-list { display: flex; flex-direction: column; gap: 1.5rem; }

        .post-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .post-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .post-content {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-color);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .post-content img {
            max-width: 100%;
            border-radius: 12px;
            margin-top: 1rem;
            display: block;
            box-shadow: var(--shadow-md);
        }

        /* åˆ é™¤æŒ‰é’® */
        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            opacity: 0;
            transition: all 0.2s;
        }
        .post-card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { background: rgba(239, 68, 68, 0.1); }

        /* --- 7. ç™»å½•/æ³¨å†Œ å¼¹çª— --- */
            /* --- 7. ç™»å½•/æ³¨å†Œ å¼¹çª— --- */
        #authPanel {
            /* é»˜è®¤éšè— */
            display: none; 
            
            /* ğŸ‘‡ å…³é”®ä¿®å¤ï¼šå¼ºåˆ¶å›ºå®šå®šä½ï¼Œå æ»¡å…¨å± */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999;
            
            /* å±…ä¸­å†…å®¹ */
            align-items: center;
            justify-content: center;

            /* èƒŒæ™¯ç£¨ç ‚æ•ˆæœ */
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
    

        .auth-box {
            background: var(--card-bg);
            padding: 2.5rem;
            border-radius: 20px;
            width: 360px;
            max-width: 90%;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            position: relative;
            transition: color 0.3s;
        }

        .auth-tab.active { color: var(--primary-color); }
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px; left: 0; right: 0;
            height: 2px;
            background: var(--primary-color);
        }

        .form-group { margin-bottom: 1.2rem; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: var(--text-secondary); }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 0.95rem;
            box-sizing: border-box; /* ç¡®ä¿paddingä¸æ’‘å¤§å®½åº¦ */
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .btn-login { background: var(--primary-color); color: white; }
        .btn-login:hover { background: var(--primary-hover); }
        
        .btn-register { background: #10b981; color: white; } /* ç»¿è‰² */
        .btn-register:hover { background: #059669; }

        .btn-close {
            width: 100%;
            padding: 8px;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
        }
        .btn-close:hover { background: var(--input-bg); color: var(--text-color); }

    </style>

</head>
<body>

    <!-- é¡¶éƒ¨å¯¼èˆª (ç£¨ç ‚ç»ç’ƒè´¨æ„Ÿ) -->
    <header>
        <div class="logo">My Website</div>
        <div class="nav-links">
            <a href="index.html">é¦–é¡µ</a>
            <a href="game.html">æ¸¸æˆ</a>
            <a href="design.html">è®¾è®¡</a>
            <a href="blog.html">æ—¥å¿—</a>
            
            <button id="authBtn" class="nav-btn">ğŸ”‘ ç™»å½•</button>
            
            <button id="themeToggle" class="nav-btn">ğŸŒ™ æ¨¡å¼</button>
        </div>
    </header>

    <div class="container">
        
        <!-- ç¼–è¾‘å™¨åŒºåŸŸ (é»˜è®¤éšè—ï¼Œç™»å½•åæ˜¾ç¤º) -->
        <div class="editor-card hidden" id="editorCard">
            <h2 class="editor-title">âœï¸ å†™ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ</h2>
            
            <!-- å›¾ç‰‡ä¸Šä¼  -->
            <div class="image-uploader">
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                <button type="button" class="upload-btn" onclick="document.getElementById('imageInput').click()">
                    ğŸ“· æ·»åŠ å›¾ç‰‡
                </button>
                <span class="upload-hint"> (å»ºè®®å°äº 500KB)</span>
                
                <div id="previewContainer">
                    <img id="imagePreview" src="">
                    <button type="button" id="removeImageBtn">âœ•</button>
                </div>
            </div>

            <textarea id="postInput" placeholder="åˆ†äº«ä½ çš„å¿ƒæƒ…ï¼Œæ”¯æŒ Emoji è¡¨æƒ…å“¦... ğŸŒˆğŸ’»âœ¨"></textarea>
            
            <div class="clearfix">
                <button id="publishBtn" class="publish-btn">å‘å¸ƒæ—¥å¿—</button>
            </div>
        </div>

        <!-- å¸–å­åˆ—è¡¨åŒºåŸŸ -->
        <div id="blogList" class="post-list">
            <!-- å¸–å­ä¼šé€šè¿‡ JS æ’å…¥åˆ°è¿™é‡Œ -->
        </div>

    </div>

    <!-- ç™»å½•/æ³¨å†Œ é¢æ¿ (ç²¾ç¾å¼¹çª—) -->
    <div id="authPanel" class="hidden">
        <div class="auth-box">
            
            <!-- é¡¶éƒ¨ Tab -->
            <div class="auth-tabs">
                <button id="tabLogin" class="auth-tab active">ç™»å½•</button>
                <button id="tabRegister" class="auth-tab">æ³¨å†Œ</button>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <div id="formLogin">
                <div class="form-group">
                    <label>é‚®ç®±</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="********">
                </div>
                <button id="btnSubmitLogin" class="auth-btn btn-login">ç«‹å³ç™»å½•</button>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div id="formRegister" style="display: none;">
                <div class="form-group">
                    <label>é‚®ç®±</label>
                    <input type="email" id="regEmail" class="form-input" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>å¯†ç  (è‡³å°‘6ä½)</label>
                    <input type="password" id="regPassword" class="form-input" placeholder="è®¾ç½®å¯†ç ">
                </div>
                <div class="form-group">
                    <label>ç¡®è®¤å¯†ç </label>
                    <input type="password" id="regConfirmPassword" class="form-input" placeholder="å†æ¬¡è¾“å…¥å¯†ç ">
                </div>
                <button id="btnSubmitRegister" class="auth-btn btn-register">æ³¨å†Œè´¦å·</button>
            </div>

            <button id="btnCloseAuth" class="btn-close">å…³é—­</button>
        </div>
    </div>

    <!-- å¼•å…¥ Firebase SDK -->
    <script type="module">
        // ğŸ‘‡ å¯¼å…¥ Firebase å‡½æ•°
        // âœ… æ–°ä»£ç ï¼ˆç»Ÿä¸€ç‰ˆæœ¬åˆ° 10.8.0ï¼‰
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js" ;
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js" ;
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // è¯»å–ä¸»é¢˜è®¾ç½®
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®äº‹ä»¶
        document.getElementById('themeToggle').addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'light' ? 'ğŸŒ™ æ¨¡å¼' : 'â˜€ï¸ æ¨¡å¼';
        });

        // ğŸ‘‡ ä½ çš„é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyCuszDYabmpna95pemynxZp0c74zysMP-k",
            authDomain: "my-awesome-blog-23802.firebaseapp.com",
            databaseURL: "https://my-awesome-blog-23802-default-rtdb.firebaseio.com",
            projectId: "my-awesome-blog-23802",
            storageBucket: "my-awesome-blog-23802.firebasestorage.app",
            messagingSenderId: "900231686530",
            appId: "1:900231686530:web:4b50022f9049bfb169479b"
        };

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const postsRef = ref(db, 'posts');

        // å…¨å±€æš´éœ²ï¼ˆå…¼å®¹æ—§ä»£ç ï¼‰
        window.db = db;
        window.postsRef = postsRef;
        window.fbPush = push;
        window.fbRemove = remove;
        window.auth = auth;

        // --- Auth UI å…ƒç´  ---
        const authPanel = document.getElementById('authPanel');
        const authBtn = document.getElementById('authBtn');
        const editorCard = document.getElementById('editorCard');
        const tabLogin = document.getElementById('tabLogin');
        const tabRegister = document.getElementById('tabRegister');
        const formLogin = document.getElementById('formLogin');
        const formRegister = document.getElementById('formRegister');

        // --- Tab åˆ‡æ¢é€»è¾‘ ---
        tabLogin.addEventListener('click', () => {
            formLogin.style.display = 'block';
            formRegister.style.display = 'none';
            tabLogin.style.borderBottom = `2px solid var(--accent-color)`;
            tabRegister.style.borderBottom = `2px solid transparent`;
        });

        tabRegister.addEventListener('click', () => {
            formLogin.style.display = 'none';
            formRegister.style.display = 'block';
            tabRegister.style.borderBottom = `2px solid var(--accent-color)`;
            tabLogin.style.borderBottom = `2px solid transparent`;
        });

        document.getElementById('btnCloseAuth').addEventListener('click', () => {
            authPanel.style.display = 'none';
        });

        // --- ç™»å½•æŒ‰é’®ç‚¹å‡» ---
        authBtn.addEventListener('click', () => {
            const user = auth.currentUser;
            if (user) {
                signOut(auth).then(() => {
                    alert('å·²å®‰å…¨é€€å‡º');
                });
            } else {
                authPanel.style.display = 'flex';
            }
        });

        // --- æ³¨å†Œé€»è¾‘ ---
        const btnSubmitRegister = document.getElementById('btnSubmitRegister');
        btnSubmitRegister.addEventListener('click', () => {
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (password !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            if (password.length < 6) {
                alert('å¯†ç é•¿åº¦è‡³å°‘éœ€è¦6ä½');
                return;
            }

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    alert('æ³¨å†ŒæˆåŠŸï¼å·²è‡ªåŠ¨ç™»å½•');
                    authPanel.style.display = 'none';
                })
                .catch((error) => {
                    alert('æ³¨å†Œå¤±è´¥: ' + error.message);
                });
        });

        // --- ç™»å½•é€»è¾‘ ---
        const btnSubmitLogin = document.getElementById('btnSubmitLogin');
        btnSubmitLogin.addEventListener('click', () => {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    alert('ç™»å½•æˆåŠŸ');
                    authPanel.style.display = 'none';
                })
                .catch((error) => {
                    alert('ç™»å½•å¤±è´¥: ' + error.message);
                });
        });

        // --- ç™»å½•çŠ¶æ€ç›‘å¬ ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // å·²ç™»å½•
                authBtn.innerHTML = 'ğŸšª é€€å‡º';
                editorCard.style.display = 'block';
            } else {
                // æœªç™»å½•
                authBtn.innerHTML = 'ğŸ”‘ ç™»å½•';
                editorCard.style.display = 'none';
            }
        });

        // --- ä¸šåŠ¡é€»è¾‘ ---
        const postInput = document.getElementById('postInput');
        const publishBtn = document.getElementById('publishBtn');
        const blogList = document.getElementById('blogList');
        const imageInput = document.getElementById('imageInput');
        const previewContainer = document.getElementById('previewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const removeImageBtn = document.getElementById('removeImageBtn');

        let currentImageBase64 = null;

        // --- å›¾ç‰‡é¢„è§ˆ ---
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            if (file.size > 500 * 1024) { 
                alert('å›¾ç‰‡è¯·é™åˆ¶åœ¨ 500KB ä»¥å†…ï¼Œé˜²æ­¢è¶…å‡º Firebase é™åˆ¶ï¼');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(event) {
                currentImageBase64 = event.target.result;
                imagePreview.src = currentImageBase64;
                previewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        removeImageBtn.addEventListener('click', () => {
            currentImageBase64 = null;
            imageInput.value = '';
            previewContainer.style.display = 'none';
        });

        // --- å®æ—¶ç›‘å¬å¸–å­ (ä¿®æ”¹ç‰ˆï¼šå¢åŠ æƒé™æ§åˆ¶) ---
        function listenToPosts() {
            blogList.innerHTML = '<div style="text-align:center; padding: 20px;">ğŸ”„ æ­£åœ¨åŠ è½½...</div>';
            onValue(postsRef, (snapshot) => {
                const data = snapshot.val();
                blogList.innerHTML = '';
                const currentUser = auth.currentUser; // è·å–å½“å‰ç”¨æˆ·

                if (!data) {
                    blogList.innerHTML = '<div style="text-align:center; opacity:0.5; padding: 20px;">ğŸ“­ æš‚æ— æ—¥å¿—ï¼Œå¿«æ¥æŠ¢æ²™å‘ï¼</div>';
                    return;
                }

                const postsArray = Object.entries(data).map(([key, value]) => {
                    return { id: key, ...value };
                }).reverse(); 

                postsArray.forEach((post) => {
                    const postCard = document.createElement('div');
                    postCard.className = 'post-card';
                    
                    const imageHtml = post.image ? `<img src="${post.image}" alt="Post Image">` : '';
                    const authorEmail = post.authorEmail || 'åŒ¿å';
                    const canDelete = currentUser && post.authorId === currentUser.uid;

                    postCard.innerHTML = `
                        <div class="post-meta">
                            <div>
                                <span>ğŸ“… ${post.date}</span>
                                <span style="margin-left: 10px;">ğŸ‘¤ ${authorEmail}</span>
                            </div>
                            ${canDelete ? `<button class="delete-btn" data-id="${post.id}">åˆ é™¤</button>` : ''}
                        </div>
                        <div class="post-content">
                            ${post.content}
                            ${imageHtml}
                        </div>
                    `;
                    blogList.appendChild(postCard);
                });

                // ç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.target.getAttribute('data-id');
                        if(confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) {
                            const postRef = ref(db, 'posts/' + id);
                            remove(postRef);
                        }
                    });
                });
            });
        }

        // --- å‘å¸ƒå¸–å­ (ä¿®æ”¹ç‰ˆï¼šå¢åŠ ä½œè€…ä¿¡æ¯) ---
        publishBtn.addEventListener('click', () => {
            // æ£€æŸ¥æ˜¯å¦ç™»å½•
            const user = auth.currentUser;
            if (!user) {
                alert('è¯·å…ˆç™»å½•æ‰èƒ½å‘å¸–ï¼');
                authPanel.style.display = 'flex';
                return;
            }

            const content = postInput.value.trim();
            if (!content && !currentImageBase64) {
                alert('å†™ç‚¹å­—æˆ–è€…ä¼ å¼ å›¾å§ï¼');
                return;
            }

            const newPost = {
                content: content,
                image: currentImageBase64,
                date: new Date().toLocaleString(),
                authorId: user.uid,       // è®°å½•ä½œè€…ID
                authorEmail: user.email   // è®°å½•ä½œè€…é‚®ç®±
            };

            push(postsRef, newPost)
                .then(() => {
                    console.log("âœ… å‘å¸ƒæˆåŠŸ");
                    postInput.value = '';
                    currentImageBase64 = null;
                    previewContainer.style.display = 'none';
                    imageInput.value = '';
                })
                .catch((error) => {
                    alert("âŒ å‘å¸ƒå¤±è´¥ï¼š" + error.message);
                });
        });

        // å¯åŠ¨ç›‘å¬
        listenToPosts();

    </script>

</body>
</html>
